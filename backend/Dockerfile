FROM node:20-alpine

# Th∆∞ m·ª•c l√†m vi·ªác
WORKDIR /app

# (Tu·ª≥ ch·ªçn) D√πng mirror npm nhanh h∆°n
ARG NPM_REGISTRY=https://registry.npmmirror.com
RUN npm config set registry $NPM_REGISTRY

# Copy package tr∆∞·ªõc ƒë·ªÉ t·∫≠n d·ª•ng cache
COPY package*.json ./

# C√†i dependencies (CI-friendly)
RUN --mount=type=cache,target=/root/.npm \
    npm ci --prefer-offline --no-audit

# C√†i nodemon (ch·ªâ d√πng n·∫øu b·∫°n ch·∫°y dev)
# üëâ N·∫øu backend prod KH√îNG c·∫ßn nodemon ‚Üí xo√° d√≤ng n√†y
RUN npm install -g nodemon

# Copy source code
COPY . .

# Expose port backend (Render s·∫Ω override b·∫±ng PORT env)
EXPOSE 5000

# Render s·∫Ω inject PORT ‚Üí b·∫°n n√™n d√πng process.env.PORT
CMD ["npm", "start"]